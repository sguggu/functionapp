name: Build and Deploy to ACA
on:
  push:
    branches:
      - main
jobs:
  build_and_push:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Login to Azure Container Registry
      uses: azure/docker-login@v1
      with:
        login-server: youracr.azurecr.io
        username: "sguggu"
        password: “$env:DOCKER_PASSWORD”

    - name: Build and push Docker image to ACR
      run: |
        docker build . -t mycontainerregistry197.azurecr.io/django-app:latest
        docker push mycontainerregistry197.azurecr.io/django-app:latest

  deploy_to_aca:
    needs: build_and_push
    runs-on: ubuntu-latest
    steps:
    - name: Login to Azure
      uses: azure/login@v1
      with:
        creds: “$env:AZURE_CREDENTIALS"

    - name: Deploy to ACA
      run: |
        az container create --resource-group Ymyrg \
                            --name containerApp555 \
                            --image mycontainerregistry197.azurecr.io/django-app:latest \
                            --cpu 1 \
                            --memory 1 \
                            --ports 80
